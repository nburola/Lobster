---
title: "LETR Sites"
author: "Nathaniel Burola, Karan Shetty, Priscilla Hare"
date: "November 13, 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include=FALSE}
#need to install lmtest package in order to install vcdExtra packages

library(tidyverse)
library(vcdExtra)

```

```{r, include=FALSE}
lobster_size <- read_csv("lobster_size_abundance.csv")
lobster_trap <- read_csv("lobster_traps.csv")
lobster_size
lobster_trap
```


```{r}
#Make the counts in the lobster size table in tidy format

lobster_size_tidy <- as.data.frame(lobster_size) %>% 
  filter(size != "-99999") %>% 
  expand.dft(freq = "count")

```

```{r}

carp_traps <- lobster_trap %>% 
  filter(site == "CARP") %>% 
  select("year","site", "traps") %>% 
  group_by(year) %>% 
  summarize("CARP traps" = sum(traps)) 

aque_traps <- lobster_trap %>% 
  filter(site == "AQUE") %>% 
  select("year","site", "traps") %>% 
  group_by(year) %>% 
  summarize("AQUE traps" = sum(traps)) 
  
sizeCARP <- lobster_size_tidy %>% 
  filter(site == "CARP") %>% 
  select("year","site", "size") %>% 
  group_by(year) %>% 
  summarize(number = n()) 


CARPmerge <- merge(carp_traps, sizeCARP, by = "year")


```


```{r}
# Part 3: Changes in lobster size between MPA and non-MPA sites

lobster_size_2012 = lobster_size_tidy %>%
  group_by(site, year) %>%
  select(year, site, size) %>% 
  filter(year == "2012")

lobster_size_2012

lobster_bar_2012 = ggplot(lobster_size_2012, aes(x = size))  +
  geom_bar(aes(color = site)) +
  facet_wrap(~ site) +
  xlab("Year") +
  ylab("Lobster size")

lobster_bar_2012

# Created a bar graph displaying size counts across all five sites for 2012. WIP



```






```{r}
#Part 4

legal_lobster<-lobster_size_tidy %>% 
  filter(year == "2017") %>% 
  mutate(
    legal = case_when(
      size >= 82.6 ~ "legal",
      size < 82.6 ~ "illegal"
    )
  ) %>% 
  select("site", "size", "legal") %>% 
  group_by(site) %>% 
  count(legal) 
  
legal_lobster2 <- as.data.frame(legal_lobster) %>% 
  spread(legal, n) %>% 
  select(-site)

rownames(legal_lobster2) <- c("AQUE", "CARP", "IVEE", "MOHK", "NAPL")

legal_lobster2

legal_prop <- prop.table(as.matrix(legal_lobster2), 1)

legal_prop

legal_x2 <- chisq.test(legal_lobster2)
legal_x2

```

